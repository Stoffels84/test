<script>
    const statusEl = document.getElementById('status');
    const table = document.getElementById('tabel');
    const thead = table.querySelector('thead');
    const tbody = table.querySelector('tbody');

    // LET OP: spaties in de bestandsnaam moeten in de URL als %20
    const excelFileUrl = 'schade%20met%20macro.xlsm';

    // Voeg hier een zoekveld toe zodra de pagina geladen is
    document.addEventListener("DOMContentLoaded", () => {
        const box = document.querySelector(".box");

        const searchInput = document.createElement("input");
        searchInput.type = "text";
        searchInput.placeholder = "Zoeken...";
        searchInput.style.padding = "8px";
        searchInput.style.width = "300px";
        searchInput.style.marginBottom = "15px";
        searchInput.style.border = "1px solid #ccc";
        searchInput.style.borderRadius = "5px";

        // Zoekfunctie
        searchInput.addEventListener("input", () => {
            const filter = searchInput.value.toLowerCase();
            const rows = tbody.getElementsByTagName("tr");

            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName("td");
                let rowMatch = false;

                for (let c = 0; c < cells.length; c++) {
                    if (cells[c].textContent.toLowerCase().includes(filter)) {
                        rowMatch = true;
                        break;
                    }
                }

                rows[i].style.display = rowMatch ? "" : "none";
            }
        });

        box.insertBefore(searchInput, table);
    });

    // Haal Excel-bestand op
    fetch(excelFileUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error('Kon het Excel-bestand niet laden (HTTP ' + response.status + ')');
            }
            return response.arrayBuffer();
        })
        .then(data => {
            statusEl.textContent = 'Excel-bestand geladen, bezig met verwerken...';

            const uint8 = new Uint8Array(data);
            const workbook = XLSX.read(uint8, { type: 'array' });

            // ðŸ‘‰ Lees specifiek het tabblad "BRON"
            const sheetName = "BRON";

            if (!workbook.SheetNames.includes(sheetName)) {
                statusEl.textContent = "Tabblad 'BRON' bestaat niet in het Excel-bestand!";
                return;
            }

            const worksheet = workbook.Sheets[sheetName];
            const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

            if (!rows || rows.length === 0) {
                statusEl.textContent = "Geen data gevonden in tabblad BRON.";
                return;
            }

            statusEl.textContent = "";

            // Kolomnamen
            const headers = rows[0];
            const headerRow = document.createElement("tr");
            headers.forEach(h => {
                const th = document.createElement("th");
                th.textContent = h;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);

            // Data
            rows.slice(1).forEach(r => {
                const tr = document.createElement("tr");
                r.forEach(cell => {
                    const td = document.createElement("td");
                    td.textContent = (cell === null || cell === undefined) ? "" : cell;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            statusEl.textContent = "Klaar. " + (rows.length - 1) + " rijen geladen.";
        })
        .catch(err => {
            console.error(err);
            statusEl.textContent = "Fout bij het laden van het Excel-bestand.";
        });
</script>
